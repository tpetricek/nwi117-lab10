# NSW117 - Lab 10

Today, we'll look at writing a script to print `ping` times, testing it using BATS and visualizing the output using a simple terminal utility that you'll need to install.

## Writing mocks script and a test

1. First, run `ping 8.8.8.8` to see what the output of ping looks like. We will want to transform this to output that prints just numbers (after the first line with general information)
2. Now, write a "mock" implementation script `times.sh` that prints something like this:

       Some ping information
       3.14
       4.15
       1.16

3. We now want to write BATS test to check that the output is in the right format, i.e. there are numbers in format `nn.nnn` after the first line. Here are some hints:

    - You can run script using `$(./times.sh ...)` and do some post-processing in `...`
    - You can use `head` and `tail` to look just at the second line (we'll only check one)
    - You cannot easily use BATS to check that the output is a number, but you can first use `sed` to replace number in valid format with some magic number like `42` and check if the output matches that
    - A better way would be to use [BATS assertion library](https://github.com/ztombol/bats-assert)

4. Check that your test actually works by making some errors in your mock script!

## Writing and testing a real implementation

1. Now, replace `times.sh` with the real implementation
2. This should run `ping 8.8.8.8` and process the output using `sed` to get just numbers
3. Note, always use `-u` as a parameter to `sed`, because this works better with infinite streams; also note that you can run multiple replacements in one command using `sed -u "s/ONE/NEWONE/; s/TWO/NEWTWO/"`
4. To make the testing work, we need to pass `-c1` parameter to `ping` so that it generates only one number. To do this, you can just pass the first command line argument passed to `times.sh` to  `ping` using `ping $1 8.8.8.8` and then call `./times.sh -c1` from the tests (this is a bit untidy, but it works)

## Installing and running `ttyplot`

1. We want to visaulize the output of `ping`, i.e., the numbers generated by our `times.sh` script. To do this, we'll use [ttyplot](https://github.com/tenox7/ttyplot).
2. Install `ttyplot`. Check out the `ttyplot` installation instructions on its wb page. On Ubuntu, this is done using `snap` which is (yet another) package manager for Linux systems. You probably do not have this installed, so install `snap` first, using [its installation instructions](https://snapcraft.io/docs/installing-snap-on-ubuntu)
3. Run `./times.sh | ttyplot`
4. You can also try the other examples from the [ttyplot web page](https://github.com/tenox7/ttyplot).

   -
